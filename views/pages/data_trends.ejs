<%- include ('../partials/header') %>

<main>
    <div class="chartCard">
        <div class="chartBox">
            <div class="dropdown">
                <button class="dropbtn">Dropdown</button>
                <div class="dropdown-content">
                    <a href="#">Top Songs by Month</a>
                    <a href="#">Views by Song</a>
                    <a href="#">Link 3</a>
                </div>
            </div>
            <canvas id="myChart"></canvas>
        </div>
    </div>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // setup 
        const data = {
            labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
            datasets: [{
                label: 'Listens',
                data: [18, 12, 6, 9, 12, 3, 9, 1, 19, 13, 4, 9],
                backgroundColor: [
                    'rgba(255, 26, 104, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(0, 0, 0, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 26, 104, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(0, 0, 0, 1)'
                ],
                borderWidth: 1
            }]
        };

        // moveChart block
        const moveChart = {     //scrollable x-axis functionality
            id: 'moveChart',
            afterEvent(chart, args) {
                const { ctx, canvas, chartArea: { left, right, top, bottom, width, height } } = chart;
                canvas.addEventListener('mousemove', (event) => {
                    const x = args.event.x;
                    const y = args.event.y;
                    //console.log('x:' + x + ' - ' + 'y:' + y)   //gives x and y coordinates of hover event
                    if (x >= left - 15 && x <= left + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {
                        canvas.style.cursor = 'pointer';    //chage to pointer when hovering over button
                    } else if (x >= right - 15 && x <= right + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {
                        canvas.style.cursor = 'pointer';
                    } else {
                        canvas.style.cursor = 'default';
                    }
                })
            },
            afterDraw(chart, args, pluginOptions) {
                const { ctx, chartArea: { left, right, top, bottom, width, height } } = chart;
                const angle = Math.PI / 180;

                class CircleChevron {
                    //constructor(x1,y1) {

                    //}
                    draw(ctx, x1, pixel) {
                        ctx.beginPath();
                        ctx.lineWidth = 3; //make a circle of 3 pixels for button
                        ctx.strokeStyle = 'rgba(102, 102, 102, 0.5)';
                        ctx.fillStyle = 'white';   //customizing button colors
                        ctx.arc(x1, height / 2 + top, 15, angle * 0, angle * 360, false)   //ctx.arc(x, y, radius, angleS, angleE, false)
                        ctx.stroke();
                        ctx.fill();
                        ctx.closePath();

                        ctx.beginPath(); //add arrow (chevron)
                        ctx.lineWidth = 3;
                        ctx.strokeStyle = 'rgba(255, 26, 104, 1)';
                        ctx.moveTo(x1 + pixel, height / 2 + top - 7.5);
                        ctx.lineTo(x1 - pixel, height / 2 + top);
                        ctx.lineTo(x1 + pixel, height / 2 + top + 7.5);
                        ctx.stroke();
                        ctx.closePath();
                    }
                }

                let drawCircleLeft = new CircleChevron();
                drawCircleLeft.draw(ctx, left, 5);

                let drawCircleRight = new CircleChevron();
                drawCircleRight.draw(ctx, right, -5);
            }
        }


        // config 
        const config = {
            type: 'bar',
            data,
            options: {
                layout: {
                    padding: {
                        right: 18
                    }
                },
                scales: {
                    x: {
                        min: 0,
                        max: 5
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            },
            plugins: [moveChart]
        };

        // render init block
        const myChart = new Chart(
            document.getElementById('myChart'),
            config
        );

        function moveScroll() {    //arrows become functional scrolling through data
            const { ctx, canvas, chartArea: { left, right, top, bottom, width, height } } = myChart;
            canvas.addEventListener('click', (event) => {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                if (x >= left - 15 && x <= left + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {  //scroll left
                    myChart.options.scales.x.min = myChart.options.scales.x.min - 1;
                    myChart.options.scales.x.max = myChart.options.scales.x.max - 1;
                    if (myChart.options.scales.x.min <= 0) {
                        myChart.options.scales.x.min = 0;
                        myChart.options.scales.x.max = 5;
                    }
                }
                if (x >= right - 15 && x <= right + 15 && y >= height / 2 + top - 15 && y <= height / 2 + top + 15) {   //scroll right
                    myChart.options.scales.x.min = myChart.options.scales.x.min + 1;
                    myChart.options.scales.x.max = myChart.options.scales.x.max + 1;
                    if (myChart.options.scales.x.max >= data.datasets[0].data.length) {
                        myChart.options.scales.x.min = data.datasets[0].data.length - 6;
                        myChart.options.scales.x.max = data.datasets[0].data.length - 1;
                    }
                }
                myChart.update();
            })
        }
        myChart.ctx.onclick = moveScroll();
    </script>
</main>

<%- include ('../partials/footer') %>